<!DOCTYPE html>
<html>
	<head>
		<title>ICAROUS 2, USER GUIDE</title>
		<!-- link to main stylesheet -->
		<link rel="stylesheet" type="text/css" href="css/main.css">
	</head>
	<body>
		<nav>
    		<ul>
        		<li><a href="index.html">Home</a></li>
	        	<li><a href="interfaces.html">Interfaces</a></li>
			<li><a href="/">Contact Us</a></li>
    		</ul>
		</nav>
		<div class="container">
    		<div class="MainTitle">
    			<img id="logo" src="../ICAROUS-logo.jpeg" alt="Icarous logo" align="right">
        		<h1>ICAROUS</h1>
        	</div><!-- /.MainTitle -->
        	<div class="main_matter">
			<h3>Interfacing Icarous with an autopilot</h3>
            <p>The default implementation of Icarous uses the cFS middleware. The various cFS applications provided in the default distribution each expect specific messages to perform their functions. This requires the use of an interface application that
                translates telemetry data received from an autopilot into appropriate messages and publishes them on the cFS software bus. Applications subscribe to relevant messages to extract the required data and perform their respective functions. The messages used by Icarous and their defintions can be found under "cFS/apps/inc/Icarous_msg.h". A few notes on implementing an interface application:</p>
                <ul>
                    <li> Aircraft position/velocity must be encoded into the position_t message.</li>
                    <li> Aircraft attitude information must be encoded in the attitude_t message.</li>
                    <li> Intruder traffic information must be endcode in an object_t message</li>
                    <li> Waypoints in a mission flight plan are each encoded in a waypoint_t message. </li>
                    <li> Vertices in a geofence are each encoded in a geofence_t message.</li> 
                </ul>
                <p>The ardupilot cFS app located under cFS/apps/ardupilot is an interface application that receives MAVLink telemetry messages from the ArduPilot autpilot, extracts relevant data and published cFS messages on the software bus. In addition to extracting required data, this app also serves as an interface to a ground station and enables data exchange between the autopilot and a ground station. The ardupilot app's interface to the autopilot/ground station can be configured to be a serial or udp port. The parameters for the port configurations are available under cFS/apps/ardupilot/fsw/tables/intf_tbl.c </p>
            <h3>Interacting with ICAROUS</h3>
            <p>The customizable nature of MAVProxy makes it a suitable ground station to interact with Icarous. We provide custom modules to upload geofences, parameters, start/reset Icarous states and simulate phantom intruder aircraft.</p>
            <h4> Uploading a flight plan </h4>
            <p>The ardupilot app piggy-backs on the MAVLink waypoint protocol to extract relevant waypoint information for Icarous when a flight plan is uploaded from the geofence. Flight plans can be uploaded by drawing them directly on the map or from a file:
            wp load path/to/file.txt</p>
            <h4> Uploading a geofence </h4>
            <p>Geofences can be drawn on the map module and saved to an xml file. See Examples/InputData/geofence.xml. Geofences can be uploaded directly by drawing on the map or from a saved xml file using the following command: 
            geofence load path/to/file.xml</p>
            <p>The custom geofence module implements a simple protocol to upload a geofence. First, a COMMAND_LONG message with the following arguments is sent to the ardupilot app:</p>
            <ul>
                <li>command: MAV_CMD_DO_FENCE_ENABLE</li>
                <li>param2: geofence index </li>
                <li>param3: type of geofence </li>
                <li>param4: total vertices in geofence </li>
                <li>param5: floor of geofence (m) </li>
                <li>param6: roof of geofence (m) </li>
            </ul>
            On receiving this command, the ardupilot app requests each vertex using the fence_fetch_point message. The ground station encodes each vertex in the fence_point message and sends it to ardupilot app. 
            <h4> Simulating intruder vehicles </h4>
            Traffic information sent to the ardupilot app is encoded into a COMMAND_LONG message as follows:
            <ul>
                <li>command: MAV_CMD_SPATIAL_USER_1</li>
                <li>param1: traffic index </li>
                <li>param2: East velocity component </li>
                <li>param3: North velocity component  </li>
                <li>param4: Up velocity component </li>
                <li>param5: latitude (degrees) </li>
                <li>param6: longitude (degrees) </li>
                <li>param7: altitude (AGL) </li>
            </ul>
        	</div>
		</div><!-- /.container -->
		<footer>
    		<ul>        		
        		<li><a href="https://github.com/nasa/icarous">github.com/nasa/icarous</a></li>
			</ul>
		</footer>
	</body>
</html>
